#!/usr/bin/env bash
set -eu

mkdir -p ./dist/server ./dist/client

release_languages=$(node -p "require('./assets/release_languages.js').join(' ')")
echo "release_languages: $release_languages"

for lang in $release_languages;
do
  ./scripts/build/build_lang_dist_file "$lang" server > "./dist/server/${lang}.json" &
  ./scripts/build/build_lang_dist_file "$lang" client > "./dist/client/${lang}.json" &
done

wait

echo "gzipping files"
rm --force dist/server/*.gz dist/client/*.gz
gzip --best --keep dist/server/* dist/client/*
