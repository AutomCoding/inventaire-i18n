#!/usr/bin/env node
let lang
const getLangKeysCount = require('./lib/get_lang_keys_count')
const getLangDefaultRegion = require('./lib/get_lang_default_region')
const releaseLanguages = require('../../assets/release_languages')
const { writeFileSync } = require('fs')

const completionData = {}

for (lang of releaseLanguages) {
  completionData[lang] = getLangKeysCount(lang)
}

const languagesData = {}

const { en: enKeysNum } = completionData

const getLangCompletion = function (langKeysNum) {
  const completion = Math.round((langKeysNum / enKeysNum) * 100)
  // When keys are deleted in the English version but not yet uploaded,
  // some language may appear with more than 100% completion
  return Math.min(completion, 100)
}

for (lang in completionData) {
  const keysNum = completionData[lang]
  languagesData[lang] = {
    completion: getLangCompletion(keysNum),
    defaultRegion: getLangDefaultRegion(lang)
  }
}

const json = JSON.stringify(languagesData, null, 2)
const file = `// Generated by scripts/update_languages_stats@inventaire-i18n
module.exports = ${json}`

writeFileSync('./dist/languages_data.js', file)
